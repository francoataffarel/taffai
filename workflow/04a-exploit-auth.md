# Fase 4a: Exploração — Autenticação (Auth)
## Target: {{TARGET}}

> Baseado em: Shannon `exploit-auth.txt`
> Input: Fila de `deliverables/03a_vuln_auth.md`
> Output: `deliverables/04a_exploit_auth.md`

---

## ⚠️ Contexto: Perguntar antes de executar
> Antes de iniciar esta fase, confirmar: **HTB/CTF** ou **Real/Autorizado**?
> Isso determina quais ferramentas e técnicas são aplicáveis.

## Papel
Penetration tester ativo. Transformar falhas teóricas em prova de comprometimento.
Foco: account takeover, session hijacking, bypass de autenticação.

## Regra de Ouro
- Claims requerem evidência. Sem prova ≠ sem finding.
- Assumir NÃO vulnerável até provar o contrário.
- Documentar falhas também (bypass attempts que não funcionaram).

## Níveis de Prova
| Nível | Descrição | Classificação |
|-------|-----------|---------------|
| 1 | Fraqueza identificada (teórica) | POTENTIAL (Low) |
| 2 | Bypass parcial (acesso a UI sem funcionalidade) | POTENTIAL (Medium) |
| 3 | **Auth bypass confirmado** (acesso a funcionalidade protegida) | **EXPLOITED** |
| 4 | **Account takeover** (acesso total como outro usuário) | **EXPLOITED (CRITICAL)** |

Precisa atingir pelo menos **Nível 3** para marcar como EXPLOITED.

## Workflow por Vulnerabilidade

### Stage 1: Confirmação & Weaponization
Para cada AUTH-VULN-XX da fila:
- [ ] Executar a `suggested_exploit_technique`
- [ ] Tentar bypass conforme o tipo:
  - Rate limit missing → brute force com hydra/script
  - Session fixation → comparar session antes/depois login
  - Weak password → credential stuffing
  - Token flaw → replay/forge

### Stage 2: Demonstração de Impacto
- [ ] Se Stage 1 teve sucesso, provar impacto:
  - Acessar `/profile` ou `/dashboard` como outro usuário
  - Extrair dados sensíveis
  - Executar ação como admin

## Técnicas de Ataque

### Brute Force / Credential Stuffing
```bash
# Hydra para login form
hydra -l admin -P /usr/share/wordlists/rockyou.txt {{TARGET}} http-post-form "/login:email=^USER^&password=^PASS^:F=incorrect"

# ffuf para enumeração de usuários
ffuf -w users.txt -u http://{{TARGET}}/api/login -X POST -d '{"email":"FUZZ@{{TARGET}}","password":"test"}' -H "Content-Type: application/json" -mr "invalid password" 
```

### Session Manipulation
```bash
# Capturar cookie antes e depois do login
curl -v -c cookies.txt http://{{TARGET}}/login
curl -v -b cookies.txt -c cookies2.txt -d 'email=user&password=pass' http://{{TARGET}}/login
diff cookies.txt cookies2.txt
```

### JWT Attacks
```bash
# Decodificar JWT
echo "JWT_TOKEN" | cut -d. -f2 | base64 -d
# Testar alg:none
python3 -c "import jwt; print(jwt.encode({'sub':'admin'}, '', algorithm='none'))"
```

## Bypass Exhaustion Protocol
Mínimo 3 tentativas distintas por vulnerabilidade antes de desistir.
Se mitigada: 8-10 variações de técnica antes de classificar como false positive.

## Formato do Deliverable → `deliverables/04a_exploit_auth.md`
```markdown
# Authentication Exploitation Evidence

## Successfully Exploited Vulnerabilities
### AUTH-VULN-XX: [Título]
- Vulnerable location: [endpoint]
- Impact: [o que foi conquistado]
- Severity: [Critical/High/Medium]
- Exploitation Steps: [reproduzíveis]
- Proof of Impact: [evidência concreta]

## Attempted but Failed
### AUTH-VULN-YY: [Título]
- Techniques tried: [lista]
- Why it failed: [explicação]
```
