# Fase 1b: CVE Research & Exploit Hunting
## Target: {{TARGET}} ({{TARGET_IP}})

> Input: `deliverables/01_pre_recon.md` (versÃµes de software)
> Output: `deliverables/01b_cve_research.md`

---

## âš ï¸ Contexto: Perguntar antes de executar
> Antes de iniciar esta fase, confirmar: **HTB/CTF** ou **Real/Autorizado**?
> Em HTB: testar agressivamente. Em Real: validar escopo antes de exploitar.

## Papel
Pesquisador de vulnerabilidades conhecidas. CorrelaÃ§Ã£o versÃ£oâ†’CVEâ†’exploitâ†’teste.
MissÃ£o: para CADA software/versÃ£o encontrado, buscar CVEs, entender o impacto, encontrar exploits pÃºblicos e TESTAR â€” mesmo que a versÃ£o pareÃ§a patcheada.

## Regras de Ouro
- **VersÃ£o patcheada NÃƒO significa seguro** â€” patches podem ser incompletos, backports mal feitos, ou config exposta.
- **Sempre testar** â€” CVE listing Ã© teoria, exploit execution Ã© prova.
- **Documentar tudo** â€” inclusive tentativas que falharam (prova de diligÃªncia).
- **CVEs vÃªm em CADEIAS** â€” ao encontrar um CVE, SEMPRE pesquisar na web se hÃ¡ CVEs companion/relacionados. Advisories frequentemente descrevem 2+ vulns que se combinam (ex: unprivilegedâ†’allow_active + allow_activeâ†’root).
- **searchsploit NÃƒO Ã© suficiente** â€” SEMPRE complementar com busca web (NVD, SOCRadar, Qualys advisories, oss-security, blogs). searchsploit pode ter o exploit mas nÃ£o explicar a cadeia completa.
- **Analisar o advisory COMPLETO** â€” nÃ£o apenas o tÃ­tulo/descriÃ§Ã£o. Ler o advisory original para entender prÃ©-requisitos, cadeias, e PoC detalhado.

---

## Metodologia

### 1. InventÃ¡rio de VersÃµes (do Pre-Recon)
Montar tabela com TUDO que tem versÃ£o identificada:

```
| Software | VersÃ£o | Fonte |
|----------|--------|-------|
| nginx | 1.21.5 | nmap + headers |
| PHP | 8.4.8 | phpinfo / X-Powered-By |
| OpenSSH | 9.6 | nmap |
| Pterodactyl Panel | 1.11.10 | changelog.txt |
| MariaDB | 11.8.3 | changelog.txt |
| Laravel | ? | fingerprint via cookies |
| PHP-PEAR | ? | phpinfo include_path |
```

### 2. Pesquisa de CVEs (para cada software)

#### Fontes (em ordem de prioridade):
1. **searchsploit** (local, rÃ¡pido):
   ```bash
   searchsploit nginx 1.21
   searchsploit pterodactyl
   searchsploit php 8.4
   searchsploit openssh 9
   searchsploit mariadb 11
   searchsploit laravel
   searchsploit pear
   ```

2. **NVD / CVE databases** (web):
   - https://nvd.nist.gov/vuln/search â€” buscar por CPE ou keyword
   - https://www.cvedetails.com/ â€” buscar por produto + versÃ£o
   - https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=PRODUTO

3. **GitHub** (exploits pÃºblicos):
   ```bash
   # Buscar no GitHub por exploits
   # PadrÃ£o: "CVE-XXXX-YYYY" + produto
   # Ou: "produto exploit RCE"
   ```
   - https://github.com/search?q=pterodactyl+exploit&type=repositories
   - https://github.com/search?q=CVE+pterodactyl&type=repositories
   - https://poc-in-github.motikan2010.net/ â€” agregador de PoCs

4. **Google Dorking**:
   ```
   "pterodactyl panel" exploit OR CVE OR RCE OR vulnerability
   "pterodactyl 1.11" CVE
   "php-pear" CVE RCE
   "nginx 1.21" CVE
   ```

5. **Exploit-DB** (web):
   - https://www.exploit-db.com/search?q=PRODUTO

### 3. AnÃ¡lise de Cada CVE Encontrado

Para cada CVE, documentar:

```markdown
### CVE-XXXX-YYYY
- **Software:** [nome + versÃ£o afetada]
- **Tipo:** RCE / SQLi / Auth Bypass / Info Disclosure / DoS / SSRF / LPE / XSS
- **CVSS Score:** X.X
- **VersÃµes afetadas:** X.X.X atÃ© Y.Y.Y
- **Nossa versÃ£o:** Z.Z.Z â€” Ã© afetada? [SIM/NÃƒO/INCERTO]
- **DescriÃ§Ã£o:** [o que faz em 1-2 linhas]
- **PrÃ©-requisitos:** [auth requerida? config especÃ­fica? allow_active?]
- **CVEs relacionados/companion:** [CVE-XXXX-ZZZZ â€” descriÃ§Ã£o da relaÃ§Ã£o]
- **Advisory original:** [URL do advisory completo â€” Qualys, oss-security, etc.]
- **Exploit pÃºblico:** [URL do PoC/exploit]
- **Status:** â¬œ NÃ£o testado | ğŸ”„ Testando | âœ… Confirmado | âŒ NÃ£o vulnerÃ¡vel
```

> **âš ï¸ REGRA OBRIGATÃ“RIA: Pesquisa Web para CADA CVE encontrado**
>
> Ao encontrar um CVE via searchsploit ou qualquer fonte:
> 1. **NVD:** `https://nvd.nist.gov/vuln/detail/CVE-XXXX-YYYY` â€” ler descriÃ§Ã£o + references
> 2. **Google:** `"CVE-XXXX-YYYY"` â€” blogs, advisories, write-ups
> 3. **SOCRadar/Qualys/etc:** buscar anÃ¡lises detalhadas que mostrem cadeias
> 4. **oss-security:** `site:openwall.com CVE-XXXX-YYYY` â€” advisories originais
> 5. **References do NVD:** clicar em CADA link de referÃªncia â€” advisories completos
>
> **Motivo:** searchsploit mostra o exploit isolado. A web mostra a CADEIA.
> Exemplo real: searchsploit mostrou CVE-2025-6018 (PAM env injection),
> mas sÃ³ a pesquisa web revelou que CVE-2025-6019 (udisks XFS resizeâ†’root)
> Ã© o companion CVE que completa a cadeia unprivilegedâ†’root.

### 4. Teste de Exploits

#### 4a. Nuclei (scan automatizado)
```bash
# Scan geral com templates de CVE
nuclei -u http://{{TARGET}} -t cves/ -severity critical,high -o evidence/nuclei_cve_results.txt

# Scan especÃ­fico por tecnologia
nuclei -u http://{{TARGET}} -tags nginx,php,laravel -o evidence/nuclei_tech_results.txt

# Scan no painel (se aplicÃ¡vel)
nuclei -u http://panel.{{TARGET}} -t cves/ -severity critical,high,medium -o evidence/nuclei_panel_results.txt

# Templates custom se necessÃ¡rio
nuclei -u http://{{TARGET}} -t /path/to/custom-template.yaml
```

#### 4b. Exploits Manuais
Para cada CVE com exploit pÃºblico:
- [ ] **Ler e entender o exploit** antes de executar (nÃ£o rodar cegamente)
- [ ] Verificar se os prÃ©-requisitos estÃ£o presentes
- [ ] Adaptar o exploit ao alvo (URLs, paths, versÃµes)
- [ ] Executar em modo de teste/validaÃ§Ã£o primeiro
- [ ] Se funcionar: capturar evidÃªncia completa
- [ ] Se falhar: documentar o motivo (patcheado? config diferente? WAF?)

#### 4c. Searchsploit + mirror
```bash
# Copiar exploit para pasta local
searchsploit -m EXPLOIT_ID
# Analisar o cÃ³digo
cat EXPLOIT_FILE
# Adaptar e executar (se aplicÃ¡vel)
```

### 5. Testar Mesmo com VersÃµes "Patcheadas"

Motivos para testar mesmo assim:
- **Backport incompleto** â€” distro pode nÃ£o ter patcheado tudo
- **Patch bypass** â€” CVEs frequentemente ganham variantes (CVE-A â†’ CVE-B)
- **ConfiguraÃ§Ã£o exposta** â€” fix pode requerer config manual pÃ³s-update
- **Falso versionamento** â€” banner pode mostrar versÃ£o errada

Abordagem:
- [ ] Testar o exploit mesmo que a versÃ£o "nÃ£o esteja na range"
- [ ] Testar variaÃ§Ãµes do exploit (encoding, paths alternativos)
- [ ] Verificar se a mitigaÃ§Ã£o foi aplicada (nÃ£o apenas a versÃ£o)

---

## Ferramentas por Contexto

| Ferramenta | HTB/CTF | Real |
|------------|---------|------|
| searchsploit | âœ… | âœ… |
| nuclei (cves/) | âœ… | âœ… (com cuidado) |
| GitHub PoCs | âœ… | âœ… (ler antes) |
| Google dorking | âœ… | âœ… |
| NVD/CVE web | âœ… | âœ… |
| Exploit-DB | âœ… | âœ… |
| Metasploit | âš ï¸ (se necessÃ¡rio) | âœ… (com autorizaÃ§Ã£o) |

---

## Formato do Deliverable â†’ `deliverables/01b_cve_research.md`

```markdown
# CVE Research Report: {{TARGET}}

## 1. Software Inventory
| Software | VersÃ£o | Fonte de DetecÃ§Ã£o |

## 2. CVEs Identificados (por criticidade)

### Critical
#### CVE-XXXX-YYYY â€” [TÃ­tulo]
- Software / VersÃ£o / CVSS / Tipo
- Exploit: [URL]
- Status: âœ… Confirmado / âŒ NÃ£o vulnerÃ¡vel / â¬œ NÃ£o testado

### High
...

### Medium
...

## 3. Exploits Testados

### Bem-sucedidos
| CVE | Software | TÃ©cnica | Impacto | EvidÃªncia |

### Falhos (mas tentados)
| CVE | Software | TÃ©cnica | Motivo da Falha |

## 4. Nuclei Results
[Output do nuclei scan]

## 5. RecomendaÃ§Ãµes para PrÃ³ximas Fases
[CVEs confirmados alimentam diretamente as fases 4a-4e]
```

---

## ğŸ”€ Decision Point: Pivotar ou Continuar?

Ao encontrar uma vulnerabilidade confirmada nesta fase, a decisÃ£o depende do **contexto**:

### HTB/CTF: Fast Pivot (priorizar cadeia de exploraÃ§Ã£o)

Quando um achado significativo Ã© confirmado:

1. **Criar pasta de achado** em `deliverables/chains/`:
   ```
   deliverables/chains/CVE-XXXX-YYYY/
   â”œâ”€â”€ finding.md          # DescriÃ§Ã£o do achado
   â”œâ”€â”€ evidence/           # Outputs, responses, screenshots
   â””â”€â”€ exploit_chain.md    # Cadeia de exploraÃ§Ã£o em construÃ§Ã£o
   ```

2. **Avaliar exploitabilidade direta:**
   - **Diretamente explorÃ¡vel** (RCE, Auth Bypass, DB creds vazadas, etc.):
     â†’ **PIVOTAR IMEDIATAMENTE** para a cadeia de exploraÃ§Ã£o. Parar fase 1b.
     â†’ Seguir o achado atÃ© onde ele levar (shell, privesc, flag).
   
   - **NÃ£o diretamente explorÃ¡vel** (LFI, Info Disclosure, config leak, etc.):
     â†’ **ANTES de continuar pesquisando mais CVEs**, revisar TODOS os achados anteriores.
     â†’ Cruzar informaÃ§Ãµes para montar cadeia combinada.
     â†’ Exemplo: `phpinfo.php` revela `register_argc_argv = On` + PEAR no include_path
       â†’ sozinhos nÃ£o fazem nada, **combinados** = RCE via PEAR cmd injection.
     â†’ Se a combinaÃ§Ã£o gerar exploit chain viÃ¡vel â†’ **PIVOTAR**.
     â†’ Se nÃ£o â†’ continuar fase 1b com os prÃ³ximos softwares.

3. **PrincÃ­pio:** Em CTF, tempo Ã© recurso escasso. NÃ£o gastar tempo avaliando 
   mais CVEs quando jÃ¡ tem uma cadeia de exploraÃ§Ã£o viÃ¡vel nas mÃ£os.

### Real/Autorizado: AnÃ¡lise Completa Primeiro

Em engagement real, a abordagem Ã© diferente:

1. **Continuar a anÃ¡lise completa** de todos os softwares mesmo apÃ³s achar vulns.
2. **Documentar todos os achados** â€” o cliente precisa do relatÃ³rio completo.
3. **Ao final da fase**, combinar achados anteriores + novos para identificar cadeias.
4. **EntÃ£o** pivotar para exploraÃ§Ã£o de forma organizada.

> Em Real: completude > velocidade. Em CTF: velocidade > completude.

### Checklist de CombinaÃ§Ã£o de Achados

Ao encontrar algo "nÃ£o diretamente explorÃ¡vel", revisar:
- [ ] **phpinfo.php** â€” `register_argc_argv`, `disable_functions`, `open_basedir`, `allow_url_*`
- [ ] **VersÃµes de software** â€” CVEs que requerem condiÃ§Ãµes especÃ­ficas (que talvez jÃ¡ existam)
- [ ] **Credenciais vazadas** â€” podem desbloquear auth para outro CVE
- [ ] **Paths internos** revelados â€” `/var/www/...` + LFI = leitura de cÃ³digo
- [ ] **Configs de serviÃ§o** â€” Redis sem senha, DB local, SMTP aberto
- [ ] **SubdomÃ­nios/vhosts** â€” achado em um pode habilitar ataque em outro

---

## IntegraÃ§Ã£o com Outras Fases

- **CVEs de Auth** (bypass, default creds) â†’ alimentam Fase 3a/4a
- **CVEs de Injection** (SQLi, RCE) â†’ alimentam Fase 3c/4c
- **CVEs de XSS** â†’ alimentam Fase 3d/4d
- **CVEs de SSRF** â†’ alimentam Fase 3e/4e
- **CVEs de RCE direto** â†’ podem pular para exploraÃ§Ã£o imediata
- **Cadeias combinadas** â†’ `deliverables/chains/` com exploit path documentado
